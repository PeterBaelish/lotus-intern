1 整理一个调度实现过程的场景梳理
2 你们产品的底层实现技术，A到B的响应，B的响应触发是什么 怎么实现数据流的先后顺序 pub-sub 
3 基于信号触发和时间触发的差异和影响，是否有负载高等情况，引起无法正常工作 （时钟中断）
	基于事件（基于少量数据），基于时间（适用于快速大量数据）
4 可抢占内核线程本质的编排实现
5 ros调度的问题，是什么原因引起

-----

#### 零、实际调度场景

- 相机离线校准
- 立体图像校正
- 视差计算
- 三维重投影
- 本质是从多个二维图像中推断出每个像素的视差，然后利用这些额外的维度数据共同重建对象
- 假设在同一节点上的不同应用程序进程之间不存在资源竞争



#### 一、apache storm要素：

- spout：数据流的来源
- bolt：中间处理函数
- topology（由DAG表示）：根据作业逻辑引导数据流

![apache storm](.\apache storm.PNG)



#### 二、实现内容

- 任务拓扑设计：如何数据、任务并行，计算资源敏感
- 任务调度：将bolt分配给合适的计算资源，计算资源敏感
- 数据流分组：考虑一个bolt的输出数据流是如何分配给下一步的并行数据流处理bolt的，尽量这些下一步的并行bolt能几乎同时完成



#### 三、任务拓扑设计

- 串行DAG

​		在gpu上执行瓶颈函数时，串行dag通常比在cpu上更实用。在这种情况下，非瓶颈功能可以在托管CPU上甚至远程CPU上

- 并行DAG（这个通常是在GPU不可用时所需要的）
  - 将数据集划分为n个，并将每个分区送入一个运行相同函数的 数据并行bolt
  - 划分算法有range、hash、复合，需要对具体瓶颈函数分析
  - 这个思想也可以用于串行DAG 分配计算任务给GPU 



#### 四、任务调度设计

- 实现一个估计bolt的性能和资源需求的机制
  - 内存使用、网络使用：大小保持不变，通过Storm提供的API获得
  - 执行时间、处理器使用（GPU,CPU）：通过在不同的处理利用率情况下测试，构造n阶多项式模型来拟合进行预测

- 实现一个工具跟踪可用资源
  - node接口带宽
  - node的CPU频率和利用率
  - 从Storm守护进程中收集JVM worker的当前内存使用情况
  - node的GPU使用率
- 实现一种具有延迟敏感的任务调度算法（LaTS）
  - 当dag在GPU上调度瓶颈bolt时，串行dag才有意义；其他非瓶颈bolt将被安排在cpu上
  - CPU调度：适用于串行DAG中的非瓶颈bolt 以及 并行DAG中的所有bolt。给定CPU上的bolt池，将他们按所需CPU时间降序排列来选取执行。对于给定的bolt和node，测量node的CPU利用率，然后用拟合的n阶多项式来预测执行时间；再测量node的可用带宽，并用bolt的输出数据流大小来估计网络传输时延。总的时延估计等于这两者相加。我们吧bolt分配给预测出最小时延的node。
  - GPU调度：适用于瓶颈bolt，同样估计最少总时延来进行分配



#### 五、数据流分组

​		比例分组：周期性测量节点的计算能力（与执行bolt的时延成反比），分配数据流使之与算力成正比。当并行bolt的最快时间与最慢时间差超过定值才会启用比例分组，否则使用apache storm默认的均分方案。



#### 六、具体方案

- 三种运行模式
  - CPU并行：在CPU上运行para-DAG bolt
  - GPU single：所有串行DAG bolt运行在同一个节点上（瓶颈bolt运行在GPU上，非瓶颈bolt运行在主机CPU上）
  - GPU混合：串行DAG 瓶颈bolt运行在一个节点的GPU上，非瓶颈bolt运行在其他节点的CPU上
- 实际应用运行模式切换方式

​		GPU和主机CPU都空闲，选择GPUsingle；慢慢的有GPU的节点的CPU会变得繁忙，切换到GPU混合；当所有GPU都繁忙时，切换到CPU并行



